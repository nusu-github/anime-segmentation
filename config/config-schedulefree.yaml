# lightning_config.yaml
seed_everything: true

# GT encoder training settings (for isnet_is/ibisnet_is only)
gt_epoch: 4

trainer:
  accelerator: gpu
  devices: 1
  precision: 16-mixed
  max_epochs: 20
  benchmark: true
  check_val_every_n_epoch: 1
  log_every_n_steps: 2
  callbacks:
    - class_path: lightning.pytorch.callbacks.ModelCheckpoint
      init_args:
        dirpath: checkpoints/
        monitor: val/Sm
        mode: max
        save_top_k: 3
        save_last: true
        auto_insert_metric_name: false
        filename: "epoch={epoch:02d}-Sm={val/Sm:.4f}"
        verbose: true
    - class_path: lightning.pytorch.callbacks.EarlyStopping
      init_args:
        monitor: val/Sm
        mode: max
        patience: 5
        min_delta: 0.001
        verbose: true
    - class_path: lightning.pytorch.callbacks.LearningRateMonitor
      init_args:
        logging_interval: epoch
  logger:
    - class_path: lightning.pytorch.loggers.TensorBoardLogger
      init_args:
        save_dir: lightning_logs
        name: anime_seg
    - class_path: lightning.pytorch.loggers.CSVLogger
      init_args:
        save_dir: lightning_logs
        name: anime_seg

model:
  net_name: isnet_is
  img_size: 1024
  compile: true
  compile_mode: max-autotune
  lr: 0.0001
  optimizer:
    class_path: torch.optim.Adam
    init_args:
      betas: [0.9, 0.999]
      eps: 1e-08
      weight_decay: 0
  # Loss weights
  loss_bce: 1.0
  loss_iou: 0.5
  loss_ssim: 0.5

data:
  # dataset_name: "your-username/your-dataset"
  data_dir: dataset/
  fg_dir: fg
  bg_dir: bg
  img_dir: imgs
  mask_dir: masks
  fg_ext: .png
  bg_ext: .jpg
  img_ext: .jpg
  mask_ext: .jpg
  data_split: 0.95
  img_size: 1024
  batch_size_train: 2
  batch_size_val: 2
  num_workers_train: 4
  num_workers_val: 4

  # Simplified augmentation (anime domain optimized)
  # Geometric transforms
  aug_rotation_degrees: 15.0
  aug_scale_range: [0.8, 1.2]
  aug_translate_ratio: 0.1
  aug_hflip_p: 0.5

  # Color transforms (light, preserves line art)
  aug_grayscale_p: 0.1
  aug_color_jitter_p: 0.2
  aug_brightness: 0.1
  aug_contrast: 0.1
  aug_saturation: 0.1
  aug_hue: 0.02

  # Compositor settings
  aug_edge_blur_p: 0.2
  aug_edge_blur_kernel_size: 5
