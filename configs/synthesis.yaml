# Copy-Paste Synthesis Configuration
# Use with: python -m anime_segmentation.training.train fit --config configs/birefnet_default.yaml --config configs/synthesis.yaml

data:
  # Enable Route B (Copy-Paste synthesis)
  enable_synthesis: true

  # Ratio of synthetic samples in training (0.0 = all real, 1.0 = all synthetic)
  synthesis_ratio: 0.3

  # Number of synthetic samples per epoch
  synthesis_length: 10000

  # Character count distribution (k)
  # k=0: negative examples (background only)
  synthesis_k_probs:
    0: 0.05   # 5% negative examples
    1: 0.35   # 35% single character
    2: 0.35   # 35% two characters
    3: 0.20   # 20% three characters
    4: 0.05   # 5% four characters

  # Character size constraints
  synthesis_min_area: 0.02     # Min 2% of canvas
  synthesis_max_area: 0.60     # Max 60% of canvas per character
  synthesis_max_coverage: 0.85 # Max 85% total coverage
  synthesis_max_overlap: 0.30  # Max 30% IoU overlap between characters

  # Blending strategy probabilities
  synthesis_blending_probs:
    hard: 0.35       # Simple alpha compositing
    feather: 0.55    # Soft edges via Gaussian blur
    seamless: 0.10   # Poisson seamless clone (high quality, low prob)

  # Boundary RGB randomization (seam shortcut suppression)
  synthesis_boundary_randomize_prob: 0.3
  synthesis_boundary_randomize_width: 3
  synthesis_boundary_randomize_noise_std: 0.05

  # Consistency processing
  enable_consistency: true
  consistency_color_prob: 0.5       # Color/tone matching
  consistency_light_wrap_prob: 0.3  # Background light bleeding
  consistency_shadow_prob: 0.3      # Drop shadow
  consistency_noise_prob: 0.3       # Noise/grain consistency

  # Quality degradation
  enable_degradation: true
  degradation_jpeg_prob: 0.3   # JPEG compression artifacts
  degradation_blur_prob: 0.1   # Gaussian blur
  degradation_noise_prob: 0.1  # Additive noise

  # Data validation
  enable_validation: true

# Trainer callbacks for debugging
trainer:
  callbacks:
    - class_path: anime_segmentation.training.callbacks.SynthesisDebugCallback
      init_args:
        output_dir: debug_synthesis
        num_samples: 16
        fixed_seed: 42
        log_every_n_epochs: 5
